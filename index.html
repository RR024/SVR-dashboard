<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="SVR Manufacturing Company - Invoice Management, Dashboard, Employee Management, and Attendance Tracking System">
    <meta name="keywords" content="manufacturing, invoice, GST, employee management, attendance">
    <title>SVR Manufacturing Dashboard</title>
    <link rel="stylesheet" href="styles.css">

    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SVR Dashboard">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23667eea' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white' font-family='Arial' font-weight='bold'>S</text></svg>">

    <!-- CDN Libraries for Advanced Features -->
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <!-- SheetJS for Excel import/export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

</head>

<body>
    <!-- Login Page (shown before main app) -->
    <!-- Login/Signup Page -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="logo-icon">S</div>
                <h1>SVR Manufacturing</h1>
                <p>Sheet Metal Component</p>
            </div>

            <!-- Tab Navigation -->
            <div class="auth-tabs">
                <button id="loginTab" class="auth-tab active" onclick="switchAuthTab('login')">
                    Login
                </button>
                <button id="signupTab" class="auth-tab" onclick="switchAuthTab('signup')">
                    Sign Up
                </button>
            </div>

            <!-- Login Form -->
            <div id="loginFormContainer">
                <form id="loginForm" class="login-form">
                    <div id="loginError" class="error-message"
                        style="display: none; padding: 0.75rem; background: rgba(231, 76, 60, 0.1); border: 1px solid #e74c3c; border-radius: var(--radius-md); color: #e74c3c; margin-bottom: 1rem; font-size: 0.875rem;">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="loginUsername" class="form-control" placeholder="Enter username" required
                            autofocus>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter password"
                            required>
                    </div>
                    <div class="form-group"
                        style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <input type="checkbox" id="rememberMe" style="width: auto; margin: 0;">
                        <label for="rememberMe"
                            style="margin: 0; cursor: pointer; font-size: 0.875rem; color: var(--text-secondary);">
                            Remember me on this device
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <span>üîê</span> Login
                    </button>
                </form>
            </div>

            <!-- Signup Form -->
            <div id="signupFormContainer" style="display: none;">
                <form id="signupForm" class="login-form">
                    <div id="signupError" class="error-message"
                        style="display: none; padding: 0.75rem; background: rgba(231, 76, 60, 0.1); border: 1px solid #e74c3c; border-radius: var(--radius-md); color: #e74c3c; margin-bottom: 1rem; font-size: 0.875rem;">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Full Name</label>
                        <input type="text" id="signupFullName" class="form-control" placeholder="Enter your full name"
                            required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Username</label>
                        <input type="text" id="signupUsername" class="form-control"
                            placeholder="Choose a username (3-20 chars)" required>
                        <small style="color: var(--text-secondary); font-size: 0.75rem;">Letters, numbers, and
                            underscores only</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Password</label>
                        <input type="password" id="signupPassword" class="form-control"
                            placeholder="Create a password (min 6 chars)" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" class="form-control"
                            placeholder="Re-enter password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <span>‚ú®</span> Create Account
                    </button>
                </form>
                <div class="login-footer" style="margin-top: 1.5rem;">
                    <small style="color: var(--text-secondary);">Already have an account? <a href="#"
                            onclick="switchAuthTab('login'); return false;"
                            style="color: var(--primary); text-decoration: none;">Login here</a></small>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">S</div>
                    <div class="logo-text">
                        <h1>SVR Manufacturing</h1>
                        <p>Sheet Metal Component</p>
                    </div>
                </div>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-module="dashboard">
                            <span class="nav-icon">üìä</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#outward-invoice" class="nav-link" data-module="outward-invoice">
                            <span class="nav-icon">üì§</span>
                            <span>Sales Invoices</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#inward-invoice" class="nav-link" data-module="inward-invoice">
                            <span class="nav-icon">üì•</span>
                            <span>Purchase Invoices</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#customers" class="nav-link" data-module="customers">
                            <span class="nav-icon">üè¢</span>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#expenses" class="nav-link" data-module="expenses">
                            <span class="nav-icon">üí∞</span>
                            <span>Expenses</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#production" class="nav-link" data-module="production">
                            <span class="nav-icon">üè≠</span>
                            <span>Production</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#hr-management" class="nav-link" data-module="hr-management">
                            <span class="nav-icon">üë•</span>
                            <span>HR Management</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="#reports" class="nav-link" data-module="reports">
                            <span class="nav-icon">üìä</span>
                            <span>Reports & Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#settings" class="nav-link" data-module="settings">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>

                <!-- Backup Status Indicator -->
                <div style="padding: 1rem; margin-top: auto; border-top: 1px solid var(--bg-tertiary);">
                    <div id="backupStatusIndicator" style="margin-bottom: 0.75rem;">
                        <div class="backup-indicator" title="Checking backup status...">
                            <span class="indicator-icon">‚è≥</span>
                            <span class="indicator-text">Checking...</span>
                        </div>
                    </div>
                    <button id="pwaInstallBtn" onclick="installPWA()" class="btn btn-sm"
                        style="width: 100%; display: none; background: var(--bg-tertiary); border: 1px dashed var(--primary); color: var(--primary); font-size: 0.75rem;">
                        üì± Install App
                    </button>
                    <a href="#" class="nav-link" onclick="logout(); return false;" style="margin-top: 0.5rem;">
                        <span class="nav-icon">üö™</span>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Dashboard Module -->
            <section id="dashboard" class="module active">
                <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2>Dashboard</h2>
                        <p>Overview of your manufacturing business</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="color: var(--text-secondary); font-size: 0.9rem; font-weight: 500;"></span>
                        <label class="toggle-switch"
                            style="position: relative; display: inline-block; width: 50px; height: 26px;">
                            <input type="checkbox" id="toggleFirstRowSwitch" onchange="toggleFirstRow()"
                                style="opacity: 0; width: 0; height: 0;">
                            <span class="toggle-slider"
                                style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.3s; border-radius: 26px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);"></span>
                        </label>
                    </div>
                </div>



                <div class="stats-grid-compact">
                    <div class="stat-card warning" onclick="showOutstandingSalesModal()" style="cursor: pointer;">
                        <div class="stat-label">Outstanding Sales</div>
                        <div class="stat-value" id="pendingSalesAmount">‚Çπ0</div>
                        <div class="stat-change" id="pendingSalesCount">0 invoices unpaid</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-label">Outstanding Purchase</div>
                        <div class="stat-value" id="pendingPurchaseAmount">‚Çπ0</div>
                        <div class="stat-change" id="pendingPurchaseCount">0 invoices unpaid</div>
                    </div>
                    <div class="stat-card" style="border-top: 4px solid #8b5cf6;">
                        <div class="stat-label">Net Outstanding</div>
                        <div class="stat-value" id="netPendingAmount">‚Çπ0</div>
                        <div class="stat-change">Sales - Purchase</div>
                    </div>
                </div>

                <!-- Statistics Cards - Row 2: Current Month Sales & Purchase -->
                <div class="stats-grid-compact">
                    <div class="stat-card success clickable-card" onclick="showCurrentMonthSalesModal()"
                        title="Click to view Sales Details">
                        <div class="stat-label">üìà Current Month Sales</div>
                        <div class="stat-value" id="currentMonthSalesAmount">‚Çπ0</div>
                        <div class="stat-change" id="currentMonthSalesCount">0 invoices</div>
                    </div>
                    <div class="stat-card clickable-card" style="border-top: 4px solid #ef4444;"
                        onclick="navigateToModule('inward-invoice')" title="Click to view Purchase Invoices">
                        <div class="stat-label">üìâ Current Month Purchase</div>
                        <div class="stat-value" id="currentMonthPurchaseAmount">‚Çπ0</div>
                        <div class="stat-change" id="currentMonthPurchaseCount">0 invoices</div>
                    </div>
                </div>

                <!-- Statistics Cards - Row 3: Today's Summary -->
                <div class="stats-grid-compact">
                    <div class="stat-card" style="border-top: 4px solid #f59e0b;" onclick="navigateToModule('expenses')"
                        title="Click to view Expenses">
                        <div class="stat-label">üí∞ Today's Expenses</div>
                        <div class="stat-value" id="todayExpensesAmount">‚Çπ0</div>
                        <div class="stat-change" id="todayExpensesCount">0 expenses</div>
                    </div>
                    <div class="stat-card" style="border-top: 4px solid #10b981;"
                        onclick="navigateToModule('production')" title="Click to view Production">
                        <div class="stat-label">üè≠ Today's Production</div>
                        <div class="stat-value" id="todayProductionQty">0</div>
                        <div class="stat-change" id="todayProductionItems">0 items produced</div>
                    </div>
                    <div class="stat-card" style="border-top: 4px solid #3b82f6;"
                        onclick="navigateToModule('hr-management'); setTimeout(() => switchHRTab('attendance'), 100);"
                        title="Click to view Attendance">
                        <div class="stat-label">‚úÖ Today's Attendance</div>
                        <div class="stat-value" id="todayAttendancePresent">0</div>
                        <div class="stat-change" id="todayAttendanceTotal">of 0 employees</div>
                    </div>
                </div>

                <!-- Statistics Cards - Row 3: Total Sales/Purchase Summary (Toggleable) -->
                <div id="firstStatsRow" class="stats-grid-compact" style="display: none;">
                    <div class="stat-card success clickable-card" onclick="navigateToModule('outward-invoice')"
                        title="Click to view Sales Invoices">
                        <div class="stat-label">Total Sales Invoices</div>
                        <div class="stat-value" id="totalOutwardCost">‚Çπ0</div>
                        <div class="stat-change" id="totalOutward">0 invoices</div>
                    </div>
                    <div class="stat-card clickable-card" onclick="navigateToModule('inward-invoice')"
                        title="Click to view Purchase Invoices">
                        <div class="stat-label">Total Purchase Invoices</div>
                        <div class="stat-value" id="totalInwardCost">‚Çπ0</div>
                        <div class="stat-change" id="totalInward">0 invoices</div>
                    </div>
                    <div class="stat-card" style="border-top: 4px solid #10b981;">
                        <div class="stat-label">Net Balance</div>
                        <div class="stat-value" id="netBalance">‚Çπ0</div>
                        <div class="stat-change">Sales - Purchase</div>
                    </div>
                </div>
            </section>

            <!-- Inward Invoice Module -->
            <section id="inward-invoice" class="module">
                <div class="page-header">
                    <h2>Purchase Invoices</h2>
                    <p>Track materials received from customers</p>
                </div>

                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem;">
                    <div style="flex: 1; max-width: 400px;">
                        <input type="text" id="inwardSearch" class="form-control"
                            placeholder="üîç Search by invoice no, customer, material..."
                            oninput="searchInward(this.value)" style="margin: 0;">
                    </div>
                    <button class="btn btn-primary" onclick="openInwardModal()">
                        <span>‚ûï</span> New Purchase Invoice
                    </button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table class="data-table" id="inwardTable">
                            <thead>
                                <tr>
                                    <th>
                                        Supplier Invoice No.
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'inwardInvoiceNo')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-inwardInvoiceNo"
                                            style="display: none;">
                                            <input type="text" class="filter-input" placeholder="Search invoice..."
                                                onkeyup="applyInwardFilter()">
                                        </div>
                                    </th>
                                    <th>
                                        Date
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'inwardDate')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-inwardDate"
                                            style="display: none;">
                                            <div style="display: flex; gap: 0.5rem; flex-direction: column;">
                                                <small style="color: var(--text-secondary);">From:</small>
                                                <input type="date" id="filter-inward-date-from" class="filter-input"
                                                    onchange="applyInwardFilter()">
                                                <small style="color: var(--text-secondary);">To:</small>
                                                <input type="date" id="filter-inward-date-to" class="filter-input"
                                                    onchange="applyInwardFilter()">
                                            </div>
                                        </div>
                                    </th>
                                    <th>
                                        Customer
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'inwardCustomer')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-inwardCustomer"
                                            style="display: none;">
                                            <select id="filter-inward-customer-select" class="filter-input"
                                                onchange="applyInwardFilter()"
                                                style="width: 100%; padding: 0.5rem; cursor: pointer;">
                                                <option value="">All Customers</option>
                                            </select>
                                        </div>
                                    </th>
                                    <th>GST No.</th>
                                    <th>Material</th>
                                    <th>Amount</th>
                                    <th>
                                        Payment Status
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'inwardPaymentStatus')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-inwardPaymentStatus"
                                            style="display: none;">
                                            <div class="filter-options">
                                                <label class="filter-option"><input type="checkbox" value="All" checked
                                                        onchange="applyInwardFilter()"> All</label>
                                                <label class="filter-option"><input type="checkbox" value="Paid"
                                                        onchange="applyInwardFilter()"> Paid</label>
                                                <label class="filter-option"><input type="checkbox" value="Pending"
                                                        onchange="applyInwardFilter()"> Pending</label>
                                                <label class="filter-option"><input type="checkbox" value="Partial"
                                                        onchange="applyInwardFilter()"> Partial</label>
                                            </div>
                                        </div>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inwardTableBody">
                                <tr>
                                    <td colspan="8" class="text-center" style="color: var(--text-secondary);">
                                        No purchase invoices yet. Click "New Purchase Invoice" to create one.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Outward Invoice Module -->
            <section id="outward-invoice" class="module">
                <div class="page-header">
                    <h2>Sales Invoices (Tax Invoice)</h2>
                    <p>Generate GST-compliant tax invoices for delivered products</p>
                </div>

                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem;">
                    <div style="flex: 1; max-width: 400px;">
                        <input type="text" id="outwardSearch" class="form-control"
                            placeholder="üîç Search by invoice no, buyer, GST..." oninput="searchOutward(this.value)"
                            style="margin: 0;">
                    </div>
                    <button class="btn btn-primary" onclick="openOutwardModal()">
                        <span>‚ûï</span> New Tax Invoice
                    </button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table class="data-table" id="outwardTable">
                            <thead>
                                <tr>
                                    <th>
                                        Invoice No.
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'invoiceNo')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-invoiceNo"
                                            style="display: none;">
                                            <input type="text" class="filter-input" placeholder="Search invoice..."
                                                onkeyup="applyOutwardFilter()">
                                            <div class="filter-options" id="filter-options-invoiceNo"></div>
                                        </div>
                                    </th>
                                    <th>
                                        Date
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'date')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-date" style="display: none;">
                                            <div style="display: flex; gap: 0.5rem; flex-direction: column;">
                                                <small style="color: var(--text-secondary);">From:</small>
                                                <input type="date" id="filter-date-from" class="filter-input"
                                                    onchange="applyOutwardFilter()" placeholder="From">
                                                <small style="color: var(--text-secondary);">To:</small>
                                                <input type="date" id="filter-date-to" class="filter-input"
                                                    onchange="applyOutwardFilter()" placeholder="To">
                                            </div>
                                        </div>
                                    </th>
                                    <th>
                                        Customer
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'customer')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-customer" style="display: none;">
                                            <select id="filter-customer-select" class="filter-input"
                                                onchange="applyOutwardFilter()"
                                                style="width: 100%; padding: 0.5rem; cursor: pointer;">
                                                <option value="">All Customers</option>
                                            </select>
                                        </div>
                                    </th>
                                    <th>GSTIN</th>
                                    <th>Taxable Value</th>
                                    <th>Total (with GST)</th>
                                    <th>
                                        Payment Status
                                        <button class="column-filter-btn"
                                            onclick="toggleColumnFilter(event, 'paymentStatus')">‚ñº</button>
                                        <div class="column-filter-dropdown" id="filter-paymentStatus"
                                            style="display: none;">
                                            <div class="filter-options">
                                                <label class="filter-option"><input type="checkbox" value="All" checked
                                                        onchange="applyOutwardFilter()"> All</label>
                                                <label class="filter-option"><input type="checkbox" value="Paid"
                                                        onchange="applyOutwardFilter()"> Paid</label>
                                                <label class="filter-option"><input type="checkbox" value="Pending"
                                                        onchange="applyOutwardFilter()"> Pending</label>
                                                <label class="filter-option"><input type="checkbox" value="Partial"
                                                        onchange="applyOutwardFilter()"> Partial</label>
                                            </div>
                                        </div>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="outwardTableBody">
                                <tr>
                                    <td colspan="8" class="text-center" style="color: var(--text-secondary);">
                                        No outward invoices yet. Click "New Tax Invoice" to create one.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Customers Module -->
            <section id="customers" class="module">
                <div class="page-header">
                    <h2>Customer Management</h2>
                    <p>Manage customer database for invoices</p>
                </div>

                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem;">
                    <div style="flex: 1; max-width: 400px;">
                        <input type="text" id="customerSearch" class="form-control"
                            placeholder="üîç Search by company, GST, contact..." oninput="searchCustomers(this.value)"
                            style="margin: 0;">
                    </div>
                    <button class="btn btn-primary" onclick="openCustomerModal()">
                        <span>‚ûï</span> Add Customer
                    </button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Company Name</th>
                                    <th>GST Number</th>
                                    <th>Contact Person</th>
                                    <th>Phone</th>
                                    <th>City</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <tr>
                                    <td colspan="6" class="text-center" style="color: var(--text-secondary);">
                                        No customers yet. Click "Add Customer" to create one.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- HR Management Module (Combined Employees, Salary & Attendance) -->
            <section id="hr-management" class="module">
                <div class="page-header">
                    <h2>üë• HR Management</h2>
                    <p>Manage employees, salaries, and attendance in one place</p>
                </div>

                <!-- Tab Navigation -->
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                    <button class="btn btn-primary hr-tab-btn active" data-tab="employees-salary"
                        onclick="switchHRTab('employees-salary')">
                        üë• Employees & Salary
                    </button>
                    <button class="btn btn-secondary hr-tab-btn" data-tab="attendance"
                        onclick="switchHRTab('attendance')">
                        ‚úÖ Attendance
                    </button>
                </div>

                <!-- Employees & Salary Tab -->
                <div id="hr-employees-salary" class="hr-tab-content">
                    <!-- Salary Summary Cards -->
                    <div class="summary-cards"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="summary-card"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Total Employees</div>
                            <div id="hrTotalEmployees" style="font-size: 2rem; font-weight: bold;">0</div>
                        </div>
                        <div class="summary-card"
                            style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Total Monthly Payroll
                            </div>
                            <div id="totalMonthlyPayroll" style="font-size: 2rem; font-weight: bold;">‚Çπ0</div>
                        </div>
                        <div class="summary-card"
                            style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Average Salary</div>
                            <div id="averageSalary" style="font-size: 2rem; font-weight: bold;">‚Çπ0</div>
                        </div>
                    </div>

                    <!-- Employees Section -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header flex-between">
                            <h3 class="card-title">üë• Employee List</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="text" id="employeeSearch" class="form-control"
                                    placeholder="üîç Search employees..." oninput="searchEmployees(this.value)"
                                    style="margin: 0; max-width: 250px;">
                                <button class="btn btn-primary" onclick="openEmployeeModal()">
                                    <span>‚ûï</span> Add Employee
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Designation</th>
                                        <th>Department</th>
                                        <th>Contact</th>
                                        <th>Net Salary</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="employeeTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center" style="color: var(--text-secondary);">
                                            No employees yet. Click "Add Employee" to register.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Salary Management Section -->
                    <div class="card">
                        <div class="card-header flex-between">
                            <h3 class="card-title">üí∞ Salary Management</h3>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <label class="form-label" style="margin: 0;">Select Month:</label>
                                <input type="month" id="salaryMonth" class="form-control"
                                    style="max-width: 200px; margin: 0;">
                                <button class="btn btn-primary" onclick="openSalaryModal()">
                                    <span>‚ûï</span> Add/Update Salary
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Employee</th>
                                        <th>Basic</th>
                                        <th>HRA</th>
                                        <th>DA</th>
                                        <th>Allowances</th>
                                        <th>Deductions</th>
                                        <th>Net Salary</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="salaryTableBody">
                                    <tr>
                                        <td colspan="9" class="text-center" style="color: var(--text-secondary);">
                                            No salary records yet. Click "Add/Update Salary" to get started.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Attendance Tab -->
                <div id="hr-attendance" class="hr-tab-content" style="display: none;">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header flex-between">
                            <h3 class="card-title">‚úÖ Mark Attendance</h3>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <label class="form-label" style="margin: 0;">Date:</label>
                                <input type="date" id="attendanceDate" class="form-control"
                                    style="max-width: 180px; margin: 0;">
                                <button class="btn btn-primary" onclick="saveAttendance()">
                                    <span>üíæ</span> Save Attendance
                                </button>
                            </div>
                        </div>
                        <div id="attendanceContainer" style="padding: var(--space-lg);">
                            <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                                Loading employees...
                            </p>
                        </div>
                    </div>

                    <!-- Attendance History -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìÖ Attendance History</h3>
                        </div>
                        <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Status</th>
                                        <th>Time In</th>
                                        <th>Time Out</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceHistoryBody">
                                    <tr>
                                        <td colspan="6" class="text-center" style="color: var(--text-secondary);">
                                            No attendance records yet.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Expense Tracking Module -->
            <section id="expenses" class="module">
                <div class="page-header">
                    <h2>Expense Tracking</h2>
                    <p>Monitor daily operational costs and expenses</p>
                </div>

                <!-- Export & Report Buttons -->
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success btn-sm" onclick="exportExpensesToExcel()"
                            title="Export to Excel">
                            üìä Excel
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="exportExpensesToPDF()" title="Export to PDF">
                            üìÑ PDF
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="openReportGenerator()"
                            title="Generate Detailed Report">
                            üìà Report
                        </button>
                    </div>
                </div>

                <!-- Expense Summary Cards -->
                <div class="expense-summary-cards"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="summary-card"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Today's Expenses</div>
                        <div id="todayExpense" style="font-size: 2rem; font-weight: bold;">‚Çπ0</div>
                    </div>
                    <div class="summary-card"
                        style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">This Week</div>
                        <div id="weekExpense" style="font-size: 2rem; font-weight: bold;">‚Çπ0</div>
                    </div>
                    <div class="summary-card"
                        style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">This Month</div>
                        <div id="monthExpense" style="font-size: 2rem; font-weight: bold;">‚Çπ0</div>
                    </div>
                    <div class="summary-card"
                        style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Total Expenses</div>
                        <div id="totalExpense" style="font-size: 2rem; font-weight: bold;">‚Çπ0</div>
                    </div>
                </div>



                <!-- Tab Navigation -->
                <div
                    style="display: flex; gap: 1rem; border-bottom: 2px solid var(--bg-tertiary); margin-bottom: 1.5rem;">
                    <button id="allExpensesTab" class="expense-tab active" onclick="switchExpenseTab('all')"
                        style="padding: 0.75rem 1.5rem; border: none; background: none; cursor: pointer; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; transition: all 0.3s;">
                        All Expenses
                    </button>
                    <button id="recurringExpensesTab" class="expense-tab" onclick="switchExpenseTab('recurring')"
                        style="padding: 0.75rem 1.5rem; border: none; background: none; cursor: pointer; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; transition: all 0.3s;">
                        Recurring Expenses
                    </button>
                </div>

                <!-- All Expenses Content -->
                <div id="allExpensesContent">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem;">
                        <div style="flex: 1; max-width: 400px;">
                            <input type="text" id="expenseSearch" class="form-control"
                                placeholder="üîç Search expenses..." oninput="searchExpenses(this.value)"
                                style="margin: 0;">
                        </div>
                        <select id="categoryFilter" class="form-control" onchange="filterByCategory(this.value)"
                            style="max-width: 200px; margin: 0;">
                            <option value="">All Categories</option>
                            <option value="Raw Materials">Raw Materials</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Transportation">Transportation/Fuel</option>
                            <option value="Maintenance">Maintenance & Repairs</option>
                            <option value="Salaries">Salaries & Wages</option>
                            <option value="Office Supplies">Office Supplies</option>
                            <option value="Rent">Rent</option>
                            <option value="Loan">Loan</option>
                            <option value="Miscellaneous">Miscellaneous</option>
                        </select>
                        <button class="btn btn-primary" onclick="openExpenseModal()">
                            <span>‚ûï</span> Add Expense
                        </button>
                    </div>



                    <!-- Expense Table -->
                    <div class="card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Reminder</th>
                                        <th>Payment Method</th>
                                        <th>Paid To</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="expenseTableBody">
                                    <tr>
                                        <td colspan="9" class="text-center" style="color: var(--text-secondary);">
                                            No expenses recorded yet. Click "Add Expense" to get started.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Analytics Charts Section -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">üìä Expense Analytics</h3>
                        </div>
                        <div style="padding: var(--space-xl);">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                                <div>
                                    <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Monthly Trend (Last 12
                                        Months)</h4>
                                    <div style="height: 250px;">
                                        <canvas id="expenseTrendChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Category Distribution
                                    </h4>
                                    <div style="height: 250px;">
                                        <canvas id="expenseCategoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Payment Method Distribution
                                </h4>
                                <div style="height: 200px; max-width: 600px;">
                                    <canvas id="paymentMethodChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recurring Expenses Content -->
                <div id="recurringExpensesContent" style="display: none;">
                    <div style="margin-bottom: 1.5rem; text-align: right;">
                        <button class="btn btn-primary" onclick="openRecurringExpenseModal()">
                            <span>‚ûï</span> Add Recurring Expense
                        </button>
                    </div>
                    <div id="recurringExpensesList"></div>
                </div>
            </section>

            <!-- Production Module -->
            <section id="production" class="module">
                <div class="page-header">
                    <h2>üè≠ Production</h2>
                    <p>Track machines, daily production, and maintenance</p>
                </div>

                <!-- Tab Navigation -->
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                    <button class="btn btn-primary production-tab-btn active" data-tab="machines"
                        onclick="switchProductionTab('machines')">
                        üîß Machines
                    </button>
                    <button class="btn btn-secondary production-tab-btn" data-tab="logs"
                        onclick="switchProductionTab('logs')">
                        üìä Production Logs
                    </button>
                    <button class="btn btn-secondary production-tab-btn" data-tab="maintenance"
                        onclick="switchProductionTab('maintenance')">
                        üõ†Ô∏è Maintenance
                    </button>
                    <button class="btn btn-secondary production-tab-btn" data-tab="live"
                        onclick="switchProductionTab('live')">
                        üî¥ Live Production
                    </button>
                </div>

                <!-- Machines Tab -->
                <div id="production-machines" class="production-tab-content">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: var(--text-primary);">Machine List</h3>
                        <button class="btn btn-primary" onclick="openMachineModal()">
                            <span>‚ûï</span> Add Machine
                        </button>
                    </div>
                    <div class="card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Machine ID</th>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Operator</th>
                                        <th>Capacity/Day</th>
                                        <th>Location</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="machinesTableBody">
                                    <tr>
                                        <td colspan="8" class="text-center" style="color: var(--text-secondary);">
                                            No machines added yet. Click "Add Machine" to create one.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Production Logs Tab -->
                <div id="production-logs" class="production-tab-content" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: var(--text-primary);">Daily Production Logs</h3>
                        <button class="btn btn-primary" onclick="openProductionLogModal()">
                            <span>‚ûï</span> Add Log
                        </button>
                    </div>
                    <div class="card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Machine</th>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Operator</th>
                                        <th>Shift</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="productionLogsTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center" style="color: var(--text-secondary);">
                                            No production logs yet. Click "Add Log" to record production.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Maintenance Tab -->
                <div id="production-maintenance" class="production-tab-content" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: var(--text-primary);">Maintenance History</h3>
                        <button class="btn btn-primary" onclick="openMaintenanceModal()">
                            <span>‚ûï</span> Add Maintenance
                        </button>
                    </div>
                    <div class="card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Machine</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                        <th>Cost</th>
                                        <th>Downtime</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="maintenanceTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center" style="color: var(--text-secondary);">
                                            No maintenance records yet. Click "Add Maintenance" to log maintenance.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Live Production Tab -->
                <div id="production-live" class="production-tab-content" style="display: none;">
                    <div style="text-align: center; max-width: 800px; margin: 0 auto;">
                        <div class="card" style="padding: 2rem;">
                            <h3 style="color: var(--text-primary); margin-bottom: 1.5rem;">üî¥ Live Production Counter
                            </h3>

                            <!-- Setup Section -->
                            <div id="liveSetupSection">
                                <div
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; text-align: left;">
                                    <div class="form-group">
                                        <label class="form-label required">Select Machine</label>
                                        <select id="liveMachine" class="form-control"
                                            onchange="loadProductsForMachine(this.value, 'liveProduct')">
                                            <option value="">-- Select Machine --</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label required">Select Product</label>
                                        <select id="liveProduct" class="form-control">
                                            <option value="">-- Select Product --</option>
                                        </select>
                                    </div>
                                </div>

                                <button class="btn btn-primary btn-lg" onclick="startLiveProduction()"
                                    style="width: 100%; padding: 1rem; font-size: 1.2rem;">
                                    üöÄ Start Production Session
                                </button>
                            </div>

                            <!-- Live Counter Section (Hidden initially) -->
                            <div id="liveCounterSection" style="display: none;">
                                <div style="margin-bottom: 2rem;">
                                    <div
                                        style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                        <span id="liveMachineDisplay"
                                            style="font-weight: bold; color: var(--primary);">Machine
                                            A</span> |
                                        <span id="liveProductDisplay">Product X</span>
                                    </div>
                                    <div id="liveTimer"
                                        style="font-family: monospace; font-size: 1.5rem; color: var(--text-secondary);">
                                        00:00:00
                                    </div>
                                </div>

                                <div
                                    style="background: var(--bg-primary); padding: 3rem; border-radius: 20px; margin-bottom: 2rem; position: relative; overflow: hidden;">
                                    <div id="strokeCounter"
                                        style="font-size: 8rem; font-weight: bold; color: var(--success); line-height: 1; font-family: 'Courier New', monospace;">
                                        0000
                                    </div>
                                    <p style="margin-top: 1rem; color: var(--text-secondary);">Strokes Counted</p>

                                    <!-- Sensor Simulation Button -->
                                    <button onclick="handleStroke()" id="sensorBtn"
                                        style="margin-top: 2rem; padding: 1rem 2rem; border-radius: 50px; border: 4px solid var(--primary); background: transparent; color: var(--primary); font-weight: bold; cursor: pointer; transition: all 0.1s active;">
                                        Tap or Press SPACE to Count
                                    </button>
                                </div>

                                <div style="display: flex; gap: 1rem; justify-content: center;">
                                    <button class="btn btn-danger btn-lg" onclick="stopLiveProduction()">
                                        ‚èπ Stop & Save
                                    </button>
                                    <button class="btn btn-secondary btn-lg" onclick="cancelLiveProduction()">
                                        ‚ùå Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports & Analytics Module -->
            <section id="reports" class="module">
                <div class="page-header">
                    <h2>Reports & Analytics</h2>
                    <p>Comprehensive business insights and reports</p>
                </div>

                <!-- Analytics Charts -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h3 class="card-title">Business Analytics</h3>
                    </div>
                    <div style="padding: var(--space-xl);">
                        <div
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-xl); margin-bottom: var(--space-xl);">
                            <div>
                                <h4 style="margin-bottom: 1rem;">Monthly Revenue</h4>
                                <canvas id="revenueChart"></canvas>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 1rem;">Invoice Status Distribution</h4>
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report Generation -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Generate Reports</h3>
                    </div>
                    <div style="padding: var(--space-xl);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-lg);">
                            <button class="btn btn-primary" onclick="generateMonthlyReport()">
                                üìä Monthly Revenue Report
                            </button>
                            <button class="btn btn-primary" onclick="generateOutstandingReport()">
                                üí∞ Outstanding Payments Report
                            </button>
                            <button class="btn btn-primary" onclick="generateAttendanceReport()">
                                ‚úÖ Attendance Summary Report
                            </button>
                            <button class="btn btn-success" onclick="generateGSTReport()">
                                üìÑ GST Tax Summary
                            </button>
                            <button class="btn btn-secondary" onclick="exportAllReports()">
                                üì• Export All Reports
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Attendance Module -->
            <section id="attendance" class="module">
                <div class="page-header">
                    <h2>Attendance Tracking</h2>
                    <p>Mark daily attendance for employees</p>
                </div>

                <div class="flex-between mb-3">
                    <div class="form-group" style="margin: 0; max-width: 300px;">
                        <label class="form-label">Select Date</label>
                        <input type="date" id="attendanceDate" class="form-control">
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-success btn-sm" onclick="markAllPresent()">Mark All Present</button>
                        <button class="btn btn-secondary btn-sm" onclick="loadAttendance()">Load Attendance</button>
                        <button class="btn btn-primary" onclick="saveAttendance()">üíæ Save Attendance</button>
                    </div>
                </div>

                <div class="card">
                    <div id="attendanceContainer"></div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h3 class="card-title">Attendance History</h3>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee Name</th>
                                    <th>Emp ID</th>
                                    <th>Status</th>
                                    <th>Time In</th>
                                    <th>Time Out</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceHistoryBody">
                                <tr>
                                    <td colspan="6" class="text-center" style="color: var(--text-secondary);">
                                        No attendance records yet.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports & Analytics Module -->
            <section id="reports" class="module">
                <div class="page-header">
                    <h2>Reports & Analytics</h2>
                    <p>Comprehensive business insights and reports</p>
                </div>

                <!-- Analytics Charts -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h3 class="card-title">Business Analytics</h3>
                    </div>
                    <div style="padding: var(--space-xl);">
                        <div
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-xl); margin-bottom: var(--space-xl);">
                            <div>
                                <h4 style="margin-bottom: 1rem;">Monthly Revenue</h4>
                                <canvas id="revenueChart"></canvas>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 1rem;">Invoice Status Distribution</h4>
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report Generation -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Generate Reports</h3>
                    </div>
                    <div style="padding: var(--space-xl);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-lg);">
                            <button class="btn btn-primary" onclick="generateMonthlyReport()">
                                üìä Monthly Revenue Report
                            </button>
                            <button class="btn btn-primary" onclick="generateOutstandingReport()">
                                üí∞ Outstanding Payments Report
                            </button>
                            <button class="btn btn-primary" onclick="generateAttendanceReport()">
                                ‚úÖ Attendance Summary Report
                            </button>
                            <button class="btn btn-success" onclick="generateGSTReport()">
                                üìÑ GST Tax Summary
                            </button>
                            <button class="btn btn-secondary" onclick="exportAllReports()">
                                üì• Export All Reports
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings/Admin Module -->
            <section id="settings" class="module">
                <div class="page-header">
                    <h2>Settings & Administration</h2>
                    <p>Manage system configuration and data</p>
                </div>

                <!-- User Management -->
                <div class="card mb-3">
                    <div class="card-header flex-between">
                        <h3 class="card-title">User Management</h3>
                        <button class="btn btn-primary btn-sm" onclick="openUserModal()">
                            ‚ûï Add User
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Full Name</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="5" class="text-center" style="color: var(--text-secondary);">
                                        Loading users...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Data Export/Import -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h3 class="card-title">Data Export/Import</h3>
                    </div>
                    <div style="padding: var(--space-xl);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-xl);">
                            <!-- Export Section -->
                            <div>
                                <h4 style="margin-bottom: 1rem;">Export Data</h4>
                                <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                                    <button class="btn btn-success" onclick="exportToJSON()">
                                        üìÑ Export All Data (JSON)
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel('inward')">
                                        üìä Export Inward Invoices (Excel)
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel('outward')">
                                        üìä Export Outward Invoices (Excel)
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel('employees')">
                                        üìä Export Employees (Excel)
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel('attendance')">
                                        üìä Export Attendance (Excel)
                                    </button>
                                </div>
                            </div>

                            <!-- Import Section -->
                            <div>
                                <h4 style="margin-bottom: 1rem;">Import Data</h4>
                                <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                                    <div>
                                        <input type="file" id="jsonImportFile" accept=".json" style="display: none;"
                                            onchange="importFromJSON(this)">
                                        <button class="btn btn-secondary"
                                            onclick="document.getElementById('jsonImportFile').click()">
                                            üì• Import from JSON Backup
                                        </button>
                                    </div>
                                    <div
                                        style="padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-md);">
                                        <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">
                                            <strong>Note:</strong> Import will merge with existing data. Create a backup
                                            before importing.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Management -->
                <div class="card">
                    <div class="card-header flex-between">
                        <h3 class="card-title">Backup Management</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary btn-sm" onclick="quickBackupToClipboard()"
                                title="Copy backup data to clipboard">
                                üìã Copy to Clipboard
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="quickBackup()">
                                üíæ Export Backup
                            </button>
                        </div>
                    </div>
                    <div style="padding: var(--space-xl);">
                        <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: var(--radius-md);">
                            <h4 style="margin-bottom: 1rem;">Backup Information</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
                                <div>
                                    <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Last Backup:</p>
                                    <p id="lastBackupInfo" style="font-size: 1.1rem; font-weight: 600;">Never</p>
                                </div>
                                <div>
                                    <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Storage Used:</p>
                                    <div id="storageUsageInfo" style="font-size: 1.1rem; font-weight: 600;">
                                        Calculating...</div>
                                    <div id="storageProgressContainer"></div>
                                </div>
                            </div>
                            <div
                                style="margin-top: 1rem; padding: 1rem; background: var(--warning); border-radius: var(--radius-sm);">
                                <p style="margin: 0; color: var(--bg-primary);">
                                    ‚ö†Ô∏è <strong>Reminder:</strong> Regular backups prevent data loss. Export your data
                                    weekly!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Inward Invoice Modal -->
    <div id="inwardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="inwardModalTitle">New Inward Invoice</h3>
                <button class="modal-close" onclick="closeInwardModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="inwardForm">
                    <input type="hidden" id="inwardId">

                    <div class="form-group">
                        <label class="form-label required">Supplier Invoice Number</label>
                        <input type="text" id="inwardInvoiceNo" class="form-control"
                            placeholder="Enter supplier's invoice number" required
                            oninput="checkInwardInvoiceDuplicate(this.value)">
                        <small id="invoiceDuplicateWarning"
                            style="color: var(--warning); display: none; margin-top: 0.25rem;">
                            ‚ö†Ô∏è This invoice number already exists!
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Date</label>
                        <input type="date" id="inwardDate" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Select Existing Customer</label>
                        <select id="inwardCustomerDropdown" class="form-control" onchange="fillInwardCustomerDetails()">
                            <option value="">-- Select Customer --</option>
                        </select>
                        <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                            Or manually enter customer name below
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Customer Name</label>
                        <input type="text" id="inwardCustomer" class="form-control" placeholder="e.g., ABC Industries"
                            required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Customer GST Number</label>
                        <input type="text" id="inwardGSTNo" class="form-control" placeholder="Auto-filled from customer"
                            maxlength="15" style="text-transform: uppercase;" readonly
                            pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}">
                        <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
                            Auto-fills when you select a customer with GST registered
                        </small>
                    </div>

                    <h4 style="color: var(--text-primary); margin: 1rem 0;">üì¶ Materials / Products</h4>

                    <div id="inwardProductItems">
                        <!-- Product rows will be added dynamically -->
                    </div>

                    <button type="button" class="btn btn-secondary btn-sm" onclick="addInwardProductRow()"
                        style="margin-bottom: 1rem;">
                        + Add Product Row
                    </button>

                    <h4 style="color: var(--text-primary); margin: 1rem 0;">üí∞ Tax Calculation</h4>

                    <div
                        style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Total Taxable Value:</span>
                            <strong id="inwardTaxableValue">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>CGST @ 9%:</span>
                            <strong id="inwardCGST">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>SGST @ 9%:</span>
                            <strong id="inwardSGST">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Rounding Off:</span>
                            <strong id="inwardRoundOff">‚Çπ0.00</strong>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; padding-top: 0.5rem; border-top: 1px solid var(--border-color); margin-top: 0.5rem;">
                            <span style="font-size: 1.125rem; font-weight: 600;">Total Amount (Rounded):</span>
                            <strong id="inwardTotalAmount"
                                style="font-size: 1.25rem; color: var(--primary);">‚Çπ0.00</strong>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Payment Status</label>
                        <select id="inwardPaymentStatus" class="form-control" required
                            onchange="toggleInwardAmountPaid()">
                            <option value="Pending">Pending</option>
                            <option value="Partial">Partial</option>
                            <option value="Paid">Paid</option>
                        </select>
                    </div>

                    <div class="form-group" id="inwardAmountPaidGroup" style="display: none;">
                        <label class="form-label required">Amount Paid (‚Çπ)</label>
                        <input type="number" id="inwardAmountPaid" class="form-control" placeholder="Enter amount paid"
                            step="0.01" min="0">
                        <small id="inwardBalanceDisplay"
                            style="color: var(--warning); display: block; margin-top: 0.25rem;"></small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes / Remarks</label>
                        <textarea id="inwardNotes" class="form-control" placeholder="Additional notes..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInwardModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveInwardInvoice()">Save Invoice</button>
            </div>
        </div>
    </div>

    <!-- Outward Invoice Modal -->
    <div id="outwardModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 class="modal-title" id="outwardModalTitle">New Tax Invoice</h3>
                <button class="modal-close" onclick="closeOutwardModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="outwardForm">
                    <input type="hidden" id="outwardId">

                    <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Invoice Details</h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Invoice No.</label>
                            <input type="text" id="outwardInvoiceNo" class="form-control" placeholder="Auto-generated"
                                readonly required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Invoice Date</label>
                            <input type="date" id="outwardDate" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">PO No.</label>
                            <input type="text" id="outwardPONo" class="form-control" placeholder="e.g., PO12345">
                        </div>

                        <div class="form-group">
                            <label class="form-label">PO Date</label>
                            <input type="date" id="outwardPODate" class="form-control">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">DC No.</label>
                            <input type="text" id="outwardDCNo" class="form-control" placeholder="e.g., DC001" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">DC Date</label>
                            <input type="date" id="outwardDCDate" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">State</label>
                            <input type="text" id="outwardState" class="form-control" placeholder="e.g., Tamil Nadu"
                                value="Tamil Nadu" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">State Code</label>
                            <input type="text" id="outwardStateCode" class="form-control" placeholder="e.g., 33"
                                value="33" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Payment Terms</label>
                            <input type="text" id="outwardPaymentTerms" class="form-control" placeholder="e.g., 45 days"
                                value="45 days">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Vehicle Number</label>
                            <input type="text" id="outwardVehicle" class="form-control" placeholder="e.g., TN200K0156">
                        </div>
                    </div>

                    <h4 style="color: var(--text-primary); margin: 1.5rem 0 1rem;">Customer Details</h4>

                    <div class="form-group">
                        <label class="form-label">Select Existing Customer</label>
                        <select id="customerDropdown" class="form-control" onchange="fillCustomerDetails()">
                            <option value="">-- Select Customer --</option>
                        </select>
                        <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                            Or manually enter details below
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Buyer Name</label>
                        <input type="text" id="outwardBuyerName" class="form-control" placeholder="M/s. Company Name"
                            required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Buyer Address</label>
                        <textarea id="outwardBuyerAddress" class="form-control"
                            placeholder="Full address with city and pincode" required></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Customer GSTIN</label>
                            <input type="text" id="outwardGSTIN" class="form-control"
                                placeholder="e.g., 33AASCM7320A1ZQ" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Contact Number</label>
                            <input type="tel" id="outwardContact" class="form-control" placeholder="e.g., 9876543210"
                                maxlength="10" pattern="[0-9]{10}">
                        </div>
                    </div>

                    <h4 style="color: var(--text-primary); margin: 1.5rem 0 1rem;">Product Details</h4>

                    <div id="productItems">
                        <!-- Product rows will be added dynamically -->
                    </div>

                    <button type="button" class="btn btn-secondary btn-sm" onclick="addProductRow()">+ Add Product
                        Row</button>

                    <h4 style="color: var(--text-primary); margin: 1.5rem 0 1rem;">Tax Calculation</h4>

                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-md);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Total Taxable Value:</span>
                            <strong id="taxableValue">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>CGST @ 9%:</span>
                            <strong id="cgstValue">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>SGST @ 9%:</span>
                            <strong id="sgstValue">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Rounding Off:</span>
                            <strong id="roundOffValue">‚Çπ0.00</strong>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; padding-top: 0.5rem; border-top: 1px solid var(--border-color); margin-top: 0.5rem;">
                            <span style="font-size: 1.125rem; font-weight: 600;">Total Amount (Rounded):</span>
                            <strong id="totalValue" style="font-size: 1.25rem; color: var(--primary);">‚Çπ0.00</strong>
                        </div>
                        <div
                            style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-card); border-radius: var(--radius-sm);">
                            <label class="form-label">Amount in Words:</label>
                            <div id="amountInWords" style="color: var(--text-secondary); font-style: italic;">-</div>
                        </div>
                    </div>

                    <div class="form-group mt-2">
                        <label class="form-label required">Payment Status</label>
                        <select id="outwardPaymentStatus" class="form-control" required
                            onchange="toggleOutwardAmountPaid()">
                            <option value="Pending">Pending</option>
                            <option value="Partial">Partial</option>
                            <option value="Paid">Paid</option>
                        </select>
                    </div>

                    <div class="form-group" id="outwardAmountPaidGroup" style="display: none;">
                        <label class="form-label required">Amount Paid (‚Çπ)</label>
                        <input type="number" id="outwardAmountPaid" class="form-control" placeholder="Enter amount paid"
                            step="0.01" min="0">
                        <small id="outwardBalanceDisplay"
                            style="color: var(--warning); display: block; margin-top: 0.25rem;"></small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeOutwardModal()">Cancel</button>
                <button class="btn btn-success" onclick="printInvoice()">üñ®Ô∏è Print Invoice</button>
                <button class="btn btn-primary" onclick="saveOutwardInvoice()">Save Invoice</button>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="customerModalTitle">Add Customer</h3>
                <button class="modal-close" onclick="closeCustomerModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <input type="hidden" id="customerId">

                    <div class="form-group">
                        <label class="form-label required">Company Name</label>
                        <input type="text" id="customerCompanyName" class="form-control"
                            placeholder="e.g., M/s. ABC Industries Pvt Ltd" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">GST Number</label>
                        <input type="text" id="customerGSTIN" class="form-control" placeholder="e.g., 33AASCM7320A1ZQ"
                            maxlength="15" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Address</label>
                        <textarea id="customerAddress" class="form-control" required
                            placeholder="Full address with city, state, and pincode"></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Contact Person</label>
                            <input type="text" id="customerContactPerson" class="form-control"
                                placeholder="e.g., John Doe">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Phone Number</label>
                            <input type="tel" id="customerPhone" class="form-control" placeholder="e.g., 9876543210"
                                maxlength="10" pattern="[0-9]{10}" required>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="customerEmail" class="form-control"
                                placeholder="e.g., info@company.com">
                        </div>

                        <div class="form-group">
                            <label class="form-label">City</label>
                            <input type="text" id="customerCity" class="form-control" placeholder="e.g., Chennai">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea id="customerNotes" class="form-control"
                            placeholder="Additional notes about this customer"></textarea>
                    </div>

                    <!-- Product Catalog Section -->
                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color);">
                        <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">
                            üì¶ Product Catalog
                        </h4>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                            Define products commonly ordered by this customer. These will appear in dropdown when
                            creating invoices.
                        </p>

                        <div id="customerProductsList" style="margin-bottom: 1rem;">
                            <!-- Product items will be dynamically added here -->
                        </div>

                        <button type="button" class="btn btn-secondary btn-sm" onclick="addCustomerProduct()">
                            + Add Product
                        </button>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCustomerModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
            </div>
        </div>
    </div>

    <!-- Backup Reminder Modal -->
    <div id="backupReminderModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">üíæ Backup Reminder</h3>
                <button class="modal-close" onclick="closeBackupReminder()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 1rem 0;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                    <p id="backupReminderMessage"
                        style="font-size: 1.1rem; margin-bottom: 1.5rem; color: var(--text-primary);">
                        Last backup was 7 days ago. Time to backup your data!
                    </p>
                    <div
                        style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1.5rem; text-align: left;">
                        <h4 style="margin-bottom: 0.5rem;">Why backup?</h4>
                        <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary);">
                            <li>Browser cache can be cleared accidentally</li>
                            <li>Computer crashes or system updates</li>
                            <li>Protect your business data</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 1rem; justify-content: space-between;">
                <button class="btn btn-secondary" onclick="dismissBackupReminder()">
                    Remind Later (24hrs)
                </button>
                <button class="btn btn-success" onclick="quickBackup()" style="flex: 1;">
                    üíæ Backup Now
                </button>
            </div>
        </div>
    </div>

    <!-- Sales Details Modal -->
    <div id="salesDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title" id="salesDetailsModalTitle">Sales Details</h3>
                <button class="modal-close" onclick="closeSalesDetailsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="data-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th style="text-align: right;">Amount</th>
                                <th style="text-align: center;">Invoices</th>
                            </tr>
                        </thead>
                        <tbody id="salesDetailsTableBody">
                            <!-- Content will be populated by JS -->
                        </tbody>
                        <tfoot id="salesDetailsTableFoot" style="font-weight: bold; background: var(--bg-tertiary);">
                            <!-- Total will be populated by JS -->
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSalesDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="employeeModalTitle">Add Employee</h3>
                <button class="modal-close" onclick="closeEmployeeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="employeeForm">
                    <input type="hidden" id="employeeId">

                    <div class="form-group">
                        <label class="form-label">Employee ID</label>
                        <input type="text" id="employeeEmpId" class="form-control" placeholder="Auto-generated"
                            readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Full Name</label>
                        <input type="text" id="employeeName" class="form-control" placeholder="e.g., John Doe" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Designation</label>
                        <input type="text" id="employeeDesignation" class="form-control"
                            placeholder="e.g., Machine Operator" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Department</label>
                        <input type="text" id="employeeDepartment" class="form-control" placeholder="e.g., Production"
                            required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Contact Number</label>
                        <input type="tel" id="employeeContact" class="form-control" placeholder="e.g., 9876543210"
                            maxlength="10" pattern="[0-9]{10}" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="employeeEmail" class="form-control"
                            placeholder="e.g., john@example.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Date of Joining</label>
                        <input type="date" id="employeeDOJ" class="form-control" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Aadhar Number</label>
                            <input type="text" id="employeeAadhar" class="form-control"
                                placeholder="e.g., 1234 5678 9012" maxlength="14" oninput="formatAadhar(this)">
                            <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
                                12-digit unique identification number
                            </small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">PAN Number</label>
                            <input type="text" id="employeePAN" class="form-control" placeholder="e.g., ABCDE1234F"
                                maxlength="10" style="text-transform: uppercase;" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}">
                            <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
                                10-character PAN card number
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Education Qualification</label>
                        <select id="employeeEducation" class="form-control">
                            <option value="">-- Select Qualification --</option>
                            <option value="Below 10th">Below 10th</option>
                            <option value="10th Pass">10th Pass</option>
                            <option value="12th Pass">12th Pass</option>
                            <option value="ITI">ITI</option>
                            <option value="Diploma">Diploma</option>
                            <option value="Graduate">Graduate</option>
                            <option value="Post Graduate">Post Graduate</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEmployeeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEmployee()">Save Employee</button>
            </div>
        </div>
    </div>

    <!-- Salary Modal -->
    <div id="salaryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="salaryModalTitle">Add/Update Salary</h3>
                <button class="modal-close" onclick="closeSalaryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="salaryForm">
                    <input type="hidden" id="salaryId">

                    <div class="form-group">
                        <label class="form-label required">Select Employee</label>
                        <select id="salaryEmployee" class="form-control" required
                            onchange="loadEmployeeSalaryDetails()">
                            <option value="">-- Select Employee --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Month</label>
                        <input type="month" id="salaryForMonth" class="form-control" required>
                    </div>

                    <h4
                        style="color: var(--text-primary); margin: 1.5rem 0 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
                        üíµ Earnings
                    </h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Basic Salary (‚Çπ)</label>
                            <input type="number" id="salaryBasic" class="form-control" placeholder="0.00" step="0.01"
                                min="0" required oninput="calculateNetSalary()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">HRA (‚Çπ)</label>
                            <input type="number" id="salaryHRA" class="form-control" placeholder="0.00" step="0.01"
                                min="0" value="0" oninput="calculateNetSalary()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">DA (‚Çπ)</label>
                            <input type="number" id="salaryDA" class="form-control" placeholder="0.00" step="0.01"
                                min="0" value="0" oninput="calculateNetSalary()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Other Allowances (‚Çπ)</label>
                            <input type="number" id="salaryAllowances" class="form-control" placeholder="0.00"
                                step="0.01" min="0" value="0" oninput="calculateNetSalary()">
                        </div>
                    </div>

                    <h4
                        style="color: var(--text-primary); margin: 1.5rem 0 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
                        üìâ Deductions
                    </h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">PF Deduction (‚Çπ)</label>
                            <input type="number" id="salaryPF" class="form-control" placeholder="0.00" step="0.01"
                                min="0" value="0" oninput="calculateNetSalary()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">ESI Deduction (‚Çπ)</label>
                            <input type="number" id="salaryESI" class="form-control" placeholder="0.00" step="0.01"
                                min="0" value="0" oninput="calculateNetSalary()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Other Deductions (‚Çπ)</label>
                            <input type="number" id="salaryOtherDeductions" class="form-control" placeholder="0.00"
                                step="0.01" min="0" value="0" oninput="calculateNetSalary()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Advance Taken (‚Çπ)</label>
                            <input type="number" id="salaryAdvance" class="form-control" placeholder="0.00" step="0.01"
                                min="0" value="0" oninput="calculateNetSalary()">
                        </div>
                    </div>

                    <!-- Net Salary Display -->
                    <div
                        style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: var(--radius-md); margin-top: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                            <span>Gross Earnings:</span>
                            <strong id="grossEarnings" style="color: var(--success);">‚Çπ0.00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                            <span>Total Deductions:</span>
                            <strong id="totalDeductions" style="color: var(--danger);">‚Çπ0.00</strong>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; padding-top: 0.75rem; border-top: 2px solid var(--border-color);">
                            <span style="font-size: 1.125rem; font-weight: 600;">Net Salary:</span>
                            <strong id="netSalaryDisplay"
                                style="font-size: 1.5rem; color: var(--primary);">‚Çπ0.00</strong>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label class="form-label required">Payment Status</label>
                        <select id="salaryPaymentStatus" class="form-control" required>
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Partial">Partial</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Remarks</label>
                        <textarea id="salaryRemarks" class="form-control"
                            placeholder="Any additional notes..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSalaryModal()">Cancel</button>
                <button class="btn btn-success" onclick="generateSalarySlip()">üñ®Ô∏è Print Slip</button>
                <button class="btn btn-primary" onclick="saveSalary()">Save Salary</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="expenseModalTitle">Add Expense</h3>
                <button class="modal-close" onclick="closeExpenseModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm" onsubmit="event.preventDefault(); saveExpense();">
                    <input type="hidden" id="expenseId">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Date</label>
                            <input type="date" id="expenseDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Category</label>
                            <select id="expenseCategory" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="Raw Materials">Raw Materials</option>
                                <option value="Utilities">Utilities (Electricity, Water)</option>
                                <option value="Transportation">Transportation/Fuel</option>
                                <option value="Maintenance">Maintenance & Repairs</option>
                                <option value="Salaries">Salaries & Wages</option>
                                <option value="Office Supplies">Office Supplies</option>
                                <option value="Rent">Rent</option>
                                <option value="Loan">Loan</option>
                                <option value="Miscellaneous">Miscellaneous</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Status</label>
                            <select id="expenseStatus" class="form-control" required onchange="toggleExpenseReminder()">
                                <option value="Paid">Paid</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group" id="expenseReminderGroup" style="display: none;">
                            <label class="form-label">Reminder Date</label>
                            <input type="date" id="expenseReminderDate" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Description</label>
                        <input type="text" id="expenseDescription" class="form-control"
                            placeholder="e.g., Office furniture purchase" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Amount (‚Çπ)</label>
                            <input type="number" id="expenseAmount" class="form-control" step="0.01" min="0"
                                placeholder="0.00" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Payment Method</label>
                            <select id="expensePaymentMethod" class="form-control" required>
                                <option value="">Select Method</option>
                                <option value="Cash">Cash</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="UPI">UPI</option>
                                <option value="Cheque">Cheque</option>
                                <option value="Credit Card">Credit Card</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Paid To</label>
                        <input type="text" id="expensePaidTo" class="form-control" placeholder="Vendor/Person name">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea id="expenseNotes" class="form-control" rows="3"
                            placeholder="Additional notes..."></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeExpenseModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Expense</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Recurring Expense Modal -->
    <div id="recurringExpenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="recurringExpenseModalTitle">Add Recurring Expense</h3>
                <button class="modal-close" onclick="closeRecurringExpenseModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="recurringExpenseForm" onsubmit="event.preventDefault(); saveRecurringExpenseTemplate();">
                    <input type="hidden" id="recurringExpenseId">

                    <div class="form-group">
                        <label class="form-label required">Description</label>
                        <input type="text" id="recurringDescription" class="form-control"
                            placeholder="e.g., Office Rent" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Category</label>
                            <select id="recurringCategory" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="Raw Materials">Raw Materials</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Transportation">Transportation/Fuel</option>
                                <option value="Maintenance">Maintenance & Repairs</option>
                                <option value="Salaries">Salaries & Wages</option>
                                <option value="Office Supplies">Office Supplies</option>
                                <option value="Rent">Rent</option>
                                <option value="Loan">Loan</option>
                                <option value="Miscellaneous">Miscellaneous</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Amount (‚Çπ)</label>
                            <input type="number" id="recurringAmount" class="form-control" step="0.01" min="0"
                                placeholder="0.00" required>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Payment Method</label>
                            <select id="recurringPaymentMethod" class="form-control" required>
                                <option value=""> Select Method</option>
                                <option value="Cash">Cash</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="UPI">UPI</option>
                                <option value="Cheque">Cheque</option>
                                <option value="Credit Card">Credit Card</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Paid To</label>
                            <input type="text" id="recurringPaidTo" class="form-control"
                                placeholder="Vendor/Person name">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Frequency</label>
                            <select id="recurringFrequency" class="form-control" required>
                                <option value="">Select Frequency</option>
                                <option value="Daily">Daily</option>
                                <option value="Weekly">Weekly</option>
                                <option value="Monthly">Monthly</option>
                                <option value="Yearly">Yearly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Start Date</label>
                            <input type="date" id="recurringStartDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Date (Optional)</label>
                            <input type="date" id="recurringEndDate" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="recurringIsActive" checked>
                            <span>Active (Generate expenses automatically)</span>
                        </label>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeRecurringExpenseModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Recurring Expense</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Expense Reminder Modal -->
    <div id="expenseReminderModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">üîî Pending Payment Reminders</h3>
                <button class="modal-close" onclick="closeExpenseReminderModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="expenseReminderList" style="display: flex; flex-direction: column; gap: 1rem;">
                    <!-- Reminders will be added here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeExpenseReminderModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Report Generator Modal -->
    <div id="reportGeneratorModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Generate Expense Report</h3>
                <button class="modal-close" onclick="closeReportGenerator()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label required">Select Month</label>
                    <select id="reportMonth" class="form-control" required>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label required">Select Year</label>
                    <input type="number" id="reportYear" class="form-control" min="2020" max="2030" value="2025"
                        required>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeReportGenerator()">Cancel</button>
                    <button class="btn btn-primary" onclick="generateMonthlyExpenseReport()">Generate Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Preview Modal -->
    <div id="reportPreviewModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Expense Report Preview</h3>
                <button class="modal-close" onclick="closeReportPreview()">√ó</button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <div id="reportPreviewContent"></div>
            </div>
        </div>
    </div>

    <!-- Quick Product Modal (for adding products from outward invoice) -->
    <div id="quickProductModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Add New Product</h3>
                <button class="modal-close" onclick="closeQuickProductModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div
                    style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1.5rem;">
                    <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                        üí° This product will be added to the selected customer's product catalog and will be available
                        in the dropdown for future invoices.
                    </p>
                </div>

                <div class="form-group">
                    <label class="form-label required">Product Description</label>
                    <input type="text" id="quickProductDescription" class="form-control"
                        placeholder="e.g., Washer Plain, 5036" autofocus>
                </div>

                <div class="form-group">
                    <label class="form-label">HSN Code</label>
                    <input type="text" id="quickProductHSN" class="form-control" placeholder="e.g., 87082900">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Price (‚Çπ)</label>
                        <input type="number" id="quickProductPrice" class="form-control" placeholder="0.00" step="0.01"
                            min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">PO Qty/Month</label>
                        <input type="number" id="quickProductPO" class="form-control" placeholder="e.g., 50000" min="0">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeQuickProductModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveQuickProduct()">Add Product</button>
            </div>
        </div>
    </div>

    <!-- PO Limit Exceeded Modal -->
    <div id="poLimitModal" class="modal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 550px; border-top: 5px solid var(--danger);">
            <div class="modal-header">
                <h3 class="modal-title" style="color: var(--danger);">‚ö†Ô∏è PO Limit Exceeded</h3>
                <button class="modal-close"
                    onclick="document.getElementById('poLimitModal').classList.remove('active')">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üö´</div>
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">Cannot Save Invoice</h4>
                    <p style="color: var(--text-secondary);">The quantity for the following product exceeds the monthly
                        Purchase Order (PO) limit.</p>
                </div>

                <div
                    style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <div id="poErrorProduct" style="font-weight: 600; font-size: 1.1rem; color: var(--primary);">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label class="form-label">Monthly Limit</label>
                            <div id="poErrorLimit" style="font-weight: 600;"></div>
                        </div>
                        <div>
                            <label class="form-label">Current Month Usage</label>
                            <div id="poErrorUsed" style="font-weight: 600;"></div>
                        </div>
                    </div>

                    <div
                        style="background: rgba(220, 53, 69, 0.1); padding: 1rem; border-radius: var(--radius-sm); border-left: 3px solid var(--danger);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--danger); font-weight: 600;">Attempting to Add:</span>
                            <span id="poErrorAttempt" style="font-weight: bold; font-size: 1.1rem;"></span>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
                            <span style="color: var(--danger); font-weight: 600;">Exceeds By:</span>
                            <span id="poErrorExceed"
                                style="font-weight: bold; font-size: 1.1rem; color: var(--danger);"></span>
                        </div>
                    </div>
                </div>

                <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-secondary); text-align: center;">
                    Please reduce the quantity or update the PO limit in the Customer module.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger"
                    onclick="document.getElementById('poLimitModal').classList.remove('active')" style="width: 100%;">
                    Close & Fix Quantity
                </button>
            </div>
        </div>
    </div>

    <!-- Monthly Update Required Modal -->
    <div id="monthlyUpdateModal" class="modal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 550px; border-top: 5px solid var(--warning);">
            <div class="modal-header">
                <h3 class="modal-title" style="color: var(--warning);">‚ö†Ô∏è Monthly Update Required</h3>
                <button class="modal-close"
                    onclick="document.getElementById('monthlyUpdateModal').classList.remove('active')">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÖ</div>
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">Product Needs Update</h4>
                    <p style="color: var(--text-secondary);">The following product has not been updated for the current
                        month.</p>
                </div>

                <div
                    style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label">Product Name</label>
                        <div id="updateRequiredProduct"
                            style="font-weight: 600; font-size: 1.1rem; color: var(--primary);"></div>
                    </div>

                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Action Required</label>
                        <p style="font-size: 0.95rem; line-height: 1.5;">
                            Please go to the <b>Customer Management</b> module, edit this customer's products, and <span
                                style="color: var(--success); font-weight: bold;">Save</span> the product details to
                            confirm the Price and PO Limit for <b><span id="updateRequiredMonth"></span></b>.
                        </p>
                    </div>
                </div>

                <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-secondary); text-align: center;">
                    This ensures that the invoice uses the correct approved rates and limits for this month.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary"
                    onclick="document.getElementById('monthlyUpdateModal').classList.remove('active')">
                    Close
                </button>
                <button class="btn btn-primary"
                    onclick="document.getElementById('monthlyUpdateModal').classList.remove('active'); document.querySelector('[data-module=\'customers\']').click();">
                    Go to Customers
                </button>
            </div>
        </div>
    </div>

    <!-- Machine Modal -->
    <div id="machineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="machineModalTitle">Add Machine</h3>
                <button class="modal-close" onclick="closeMachineModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="machineForm">
                    <input type="hidden" id="machineId">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Machine Name</label>
                            <input type="text" id="machineName" class="form-control" placeholder="e.g., CNC Machine 1"
                                required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Machine ID</label>
                            <input type="text" id="machineCode" class="form-control" placeholder="e.g., MC-001">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Machine Type</label>
                            <select id="machineType" class="form-control" required>
                                <option value="">-- Select Type --</option>
                                <option value="CNC">CNC Machine</option>
                                <option value="Lathe">Lathe Machine</option>
                                <option value="Press">Press Machine</option>
                                <option value="Drilling">Drilling Machine</option>
                                <option value="Milling">Milling Machine</option>
                                <option value="Welding">Welding Machine</option>
                                <option value="Cutting">Cutting Machine</option>
                                <option value="Grinding">Grinding Machine</option>
                                <option value="Bending">Bending Machine</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="machineStatus" class="form-control">
                                <option value="Running">Running</option>
                                <option value="Idle">Idle</option>
                                <option value="Maintenance">Under Maintenance</option>
                                <option value="Breakdown">Breakdown</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Current Operator</label>
                            <select id="machineOperator" class="form-control">
                                <option value="">-- No Operator --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Capacity (Units/Day)</label>
                            <input type="number" id="machineCapacity" class="form-control" placeholder="e.g., 500">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Location / Bay</label>
                        <input type="text" id="machineLocation" class="form-control" placeholder="e.g., Bay A, Floor 1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Products This Machine Can Make</label>
                        <div id="productCheckboxes"
                            style="max-height: 150px; overflow-y: auto; padding: 0.5rem; background: var(--bg-tertiary); border-radius: var(--radius-md);">
                            <p style="color: var(--text-secondary);">Loading products...</p>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMachineModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveMachine()">Save Machine</button>
            </div>
        </div>
    </div>

    <!-- Production Log Modal -->
    <div id="productionLogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productionLogModalTitle">Add Production Log</h3>
                <button class="modal-close" onclick="closeProductionLogModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="productionLogForm">
                    <input type="hidden" id="productionLogId">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Date</label>
                            <input type="date" id="logDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Shift</label>
                            <select id="logShift" class="form-control">
                                <option value="Morning">Morning</option>
                                <option value="Afternoon">Afternoon</option>
                                <option value="Night">Night</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Machine</label>
                        <select id="logMachine" class="form-control" required>
                            <option value="">-- Select Machine --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Product</label>
                        <select id="logProduct" class="form-control" required>
                            <option value="">-- Select Product --</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Quantity Produced</label>
                            <input type="number" id="logQuantity" class="form-control" placeholder="e.g., 250" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Operator</label>
                            <select id="logOperator" class="form-control">
                                <option value="">-- Select Operator --</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea id="logNotes" class="form-control" placeholder="Any remarks..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeProductionLogModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProductionLog()">Save Log</button>
            </div>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div id="maintenanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Maintenance Log</h3>
                <button class="modal-close" onclick="closeMaintenanceModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="maintenanceForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label required">Date</label>
                            <input type="date" id="maintenanceDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Maintenance Type</label>
                            <select id="maintenanceType" class="form-control" required>
                                <option value="Scheduled">Scheduled Maintenance</option>
                                <option value="Breakdown">Breakdown Repair</option>
                                <option value="Repair">General Repair</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Machine</label>
                        <select id="maintenanceMachine" class="form-control" required>
                            <option value="">-- Select Machine --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="maintenanceDescription" class="form-control"
                            placeholder="What maintenance was performed..."></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Cost (‚Çπ)</label>
                            <input type="number" id="maintenanceCost" class="form-control" placeholder="e.g., 5000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Downtime (Hours)</label>
                            <input type="number" id="maintenanceDowntime" class="form-control" placeholder="e.g., 4"
                                step="0.5">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMaintenanceModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveMaintenanceLog()">Save Maintenance</button>
            </div>
        </div>
    </div>

    <!-- Toggle First Row Script & Styles -->
    <style>
        /* Toggle Switch Slider Animation */
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked+.toggle-slider {
            background-color: var(--primary, #667eea);
        }

        input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-slider:hover {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 8px rgba(102, 126, 234, 0.3);
        }
    </style>

    <script>
        // Toggle function for first row visibility (displays as 3rd row when enabled)
        function toggleFirstRow() {
            const firstRow = document.getElementById('firstStatsRow');
            const toggleSwitch = document.getElementById('toggleFirstRowSwitch');

            if (toggleSwitch.checked) {
                // Show the row (as 3rd row)
                firstRow.style.display = 'grid';
                localStorage.setItem('firstRowVisible', 'true');
            } else {
                // Hide the row
                firstRow.style.display = 'none';
                localStorage.setItem('firstRowVisible', 'false');
            }
        }

        // Restore the state on page load
        document.addEventListener('DOMContentLoaded', function () {
            const firstRow = document.getElementById('firstStatsRow');
            const toggleSwitch = document.getElementById('toggleFirstRowSwitch');
            const isVisible = localStorage.getItem('firstRowVisible');

            // Default to hidden (false), unless explicitly set to true
            if (isVisible === 'true') {
                firstRow.style.display = 'grid';
                toggleSwitch.checked = true;
            } else {
                // Default state: hidden
                firstRow.style.display = 'none';
                toggleSwitch.checked = false;
                localStorage.setItem('firstRowVisible', 'false');
            }
        });
    </script>


    <!-- Authentication System (loaded first) -->
    <script src="auth.js"></script>

    <script src="search.js"></script>
    <script src="backup-system.js"></script>
    <script src="expenses.js"></script>
    <script src="expenses-dashboard.js"></script>
    <script src="expense-analytics.js"></script>
    <script src="recurring-expenses.js"></script>
    <script src="expense-reports.js"></script>
    <script src="customers.js"></script>
    <script src="production.js"></script>
    <script src="advanced-features.js"></script>
    <script src="expense-init.js"></script>
    <script src="production-features.js"></script>
    <script src="salary.js"></script>
    <script src="dashboard_popups.js"></script>
    <script src="pdf-generator.js"></script>
    <script src="enhanced-search.js"></script>
    <script src="app.js"></script>
</body>

</html>